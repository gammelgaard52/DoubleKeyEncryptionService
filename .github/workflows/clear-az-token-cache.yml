name: Clear Az token cache

on:
  workflow_dispatch:

jobs:
  setup-azure:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
    steps:
      - name: Login to Azure
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS_SUB_PLATFORM_DKE }}

      - name: Clear Azure Token Cache Files
        run: |
          # Define the files to clear
          CACHE_FILES=("~/.azure/msal_token_cache.bin" "~/.azure/msal_token_cache.json" "~/.IdentityService/msal.cache")
      
          # Loop through the files and clear them if they exist
          for file in "${CACHE_FILES[@]}"; do
            if [ -f $file ]; then
              echo "Clearing file: $file"
              rm -f $file
            else
              echo "File not found: $file"
            fi
          done
              
      - name: Logout
        uses: azure/cli@v2
        with:
          azcliversion: latest
          inlineScript: |
            az logout